# RTSP to MSE Web Player

This project is a C++ server that receives an RTSP video stream, remuxes it to an fMP4 container, and streams it over a WebSocket to a web client for live playback using Media Source Extensions (MSE).

## Features
- Connects to an RTSP stream.
- Remuxes H.264 video to fMP4 without transcoding.
- Streams fMP4 fragments over WebSocket.
- Serves a simple HTML/JS client for playback.
- High-performance, low-latency streaming suitable for live video.

## Dependencies

You will need a C++17 compiler, CMake, and the following libraries:

- **FFmpeg:** For handling the RTSP stream and remuxing.
- **uWebSockets:** For the high-performance WebSocket server.
- **libuv:** A dependency for uWebSockets.

### Installation

**On Debian/Ubuntu:**
```bash
sudo apt update
sudo apt install build-essential cmake pkg-config
sudo apt install libavformat-dev libavcodec-dev libavutil-dev libswresample-dev libswscale-dev
# For uWebSockets, you may need to build from source
# First, install libuv
sudo apt install libuv1-dev
# Then, follow instructions at https://github.com/uNetworking/uWebSockets
```

**On macOS (using Homebrew):**
```bash
brew install cmake pkg-config
brew install ffmpeg
brew install libuv
# For uWebSockets, follow instructions at https://github.com/uNetworking/uWebSockets
```

## Build and Run

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd rtsp-to-mse-server
    ```

2.  **Configure and build the project:**
    ```bash
    mkdir build
    cd build
    cmake ..
    make
    ```

3.  **Run the server:**
    ```bash
    ./rtsp_server
    ```

4.  **View the stream:**
    Open your web browser and navigate to `http://localhost:8080` (or the configured port).

## How it Works

The server is composed of two main parts:
1.  **FFmpeg Thread:** A dedicated thread opens the RTSP input using `libavformat`, creates an output context for fMP4, and continuously reads packets. The packets are remuxed and written to an in-memory buffer.
2.  **uWebSockets Server:** The main thread runs a `uWebSockets` event loop. It serves the static `index.html` and `client.js` files via HTTP. When a client connects via WebSocket, it's added to a list of subscribers. The server then sends the fMP4 fragments generated by the FFmpeg thread to all connected clients.

The client-side JavaScript uses the Media Source Extensions API to feed the received fMP4 fragments into the browser's video player.
